FROM centos:7

USER root

RUN yum -y update && yum clean all && yum install -y wget && yum install -y vim

ENV PATH="/root/miniconda3/bin:${PATH}"
ARG PATH="/root/miniconda3/bin:${PATH}"

# get miniconda
RUN wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh

# install in batch (silent) mode, does not edit PATH or .bashrc or .bash_profile
RUN bash Miniconda3-latest-Linux-x86_64.sh -b

RUN conda update -y conda

# cleanup
RUN rm Miniconda3-latest-Linux-x86_64.sh

# install django app and dependencies
COPY xasdb/. /app
RUN chmod 777 /app && chmod 777 /root && chmod 777 /usr
RUN conda env update --file app/requirements_mamba.yaml

EXPOSE 8085

ENTRYPOINT ["/bin/sh"]
