FROM rockylinux:8
USER root

RUN yum -y update && yum clean all

RUN yum install -y vim python3.9 nss-pam-ldapd
RUN sed -i 's/sss/ldap/g' /etc/nsswitch.conf
RUN ln -fs /usr/bin/python3 /usr/bin/python

COPY xasdb/. /app
COPY BuildDockerImage/. /app/BuildDockerImage
RUN pip3 install --no-cache-dir -r /app/BuildDockerImage/requirementsRhel8.txt
RUN chmod -R 777 /app && chmod 777 /root && chmod 777 /usr
RUN sed -i 's/hashlib.md5()/hashlib.md5(usedforsecurity=False)/g' /usr/local/lib/python3.9/site-packages/django/db/backends/utils.py

WORKDIR /app

EXPOSE 8085

ENTRYPOINT ["/bin/bash"]
